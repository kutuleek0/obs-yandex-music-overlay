OBS Music Overlay — «СЕЙЧАС ИГРАЕТ» для Яндекс Музыки

Кратко
- Работает на Windows с десктоп‑приложением Яндекс Музыки.
- Показывает плашку «СЕЙЧАС ИГРАЕТ»: обложка, название, исполнитель, прогресс.
- Длинные названия скроллятся плавно; ширина настраивается.

Быстрый старт (Windows, готовая сборка)
1) Откройте папку dist\win-x64
2) Запустите obs-music-overlay.exe
3) В OBS добавьте Browser Source (Браузер) и укажите URL:
   http://localhost:3000/?w=560
   - w — ширина плашки в пикселях (минимум 300). Примеры: ?w=300, ?w=420, ?w=560
4) Откройте Яндекс Музыку (десктоп‑приложение). Появится плашка «Сейчас играет».

Как это работает
- Приложение использует системный SMTC (Windows Global System Media Transport Controls) для чтения текущего трека.
- Фильтрация включена только на Яндекс Музыку. YouTube и другие источники игнорируются.

Настройка
- Ширина: параметр URL w=..., пример: http://localhost:3000/?w=420
- Фильтр приложения (если нужно): переменная окружения YM_ALLOW (по умолчанию 'yandex,music').
  Пример запуска с кастомным фильтром:
  set YM_ALLOW=yandex,music
  obs-music-overlay.exe

Добавление в OBS
1) Источник → Браузер
2) URL: http://localhost:3000/?w=560 (берите вашу ширину)
3) Ширина и Высота источника в OBS можно ставить шире/выше — это не критично; реальная ширина управляется параметром w.
4) Прозрачность фона поддерживается (оверлей на прозрачном фоне). При необходимости подберите цвет под ваш дизайн.

Типичные проблемы и решения
1) Плашка не появляется
   - Убедитесь, что запущен obs-music-overlay.exe (в консоли есть строка Server listening on http://localhost:3000)
   - Проверьте URL источника в OBS: http://localhost:3000/?w=560
   - Откройте Яндекс Музыку (десктоп‑клиент). В браузере Яндекс Музыки SMTC может работать нестабильно.
   - Введите в браузере http://localhost:3000/api/now — должен вернуться JSON текущего состояния.

2) Показывается «не та программа» (например, YouTube)
   - Встроен фильтр по AUMID, по умолчанию только Яндекс Музыка. Если вдруг не срабатывает — уточните AUMID:
     Откройте http://localhost:3000/api/debug/app — там виден appId. Для переопределения:
     set YM_ALLOW=<фрагменты через запятую>
     Пример: set YM_ALLOW=yandex,music

3) При смене трека плашка пропадает или не обновляется
   - В OBS нажмите «Обновить кэш текущей страницы» на источнике Браузер.
   - В последних версиях реализованы фиксы; если повторяется — перезапустите exe и OBS.
   - Проверьте http://localhost:3000/api/now во время воспроизведения (должно быть состояние Playing).

4) Длинные названия дергаются / затемняются по краям
   - Реализован rAF‑скролл с учётом gap и без рывков. Если дергается на конкретном треке — пришлите пример.

5) Пустая обложка
   - Некоторые треки не отдают миниатюру через SMTC. Плашка работает с текстом.

6) Права/антивирус
   - Если EXE блокируется, добавьте папку dist\win-x64 в исключения антивируса/SmartScreen.

Поддержка
Если что-то не работает, пришлите:
- Скриншот окна приложения/OBS
- Версию Windows/OBS
- Вывод http://localhost:3000/api/now
- Описание действий, при которых возникает проблема
